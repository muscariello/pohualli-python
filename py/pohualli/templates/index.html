<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Pohualli Calendar Converter</title>
<style>
body { font-family: system-ui, sans-serif; margin: 2rem; background:#fafafa; }
header { margin-bottom:1.5rem; }
form { margin-bottom:1.5rem; background:#fff; padding:1rem 1.25rem; border:1px solid #ccc; border-radius:8px; display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:1rem; }
label { display:block; margin:.2rem 0 .25rem; font-weight:600; }
input { padding:.4rem .6rem; font-size:1rem; width: 100%; }
button { padding:.55rem 1rem; font-size:1rem; cursor:pointer; }
.actions { grid-column: 1 / -1; }
.download { margin-left:.5rem; }
pre { background:#272822; color:#f8f8f2; padding:1rem; overflow:auto; border-radius:6px; }
.error { color:#b00020; font-weight:600; }
footer { margin-top:2rem; font-size:.85rem; color:#666; }
.grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(220px,1fr)); gap:1rem; }
.card { background:#fff; border:1px solid #ddd; border-radius:8px; padding:.75rem .9rem; }
.card h3 { margin:.1rem 0 .4rem; font-size:1rem; }
.value { font-family:monospace; }
</style>
<script>
function downloadJSON(){
  const pre = document.getElementById('rawjson');
  if(!pre) return;
  const blob = new Blob([pre.textContent], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'pohualli_result.json';
  a.click();
}
</script>
</head>
<body>
<header>
  <h1>Pohualli Calendar Converter</h1>
  <p>Enter parameters to view composite Mesoamerican calendar data.</p>
</header>
<form method="get" action="/">
  <div>
    <label for="jdn">Julian Day Number</label>
    <input type="number" id="jdn" name="jdn" value="{{ comp.jdn if comp else '' }}" required />
  </div>
  <div>
    <label for="newEra">New Era (override)</label>
    <input type="number" id="newEra" name="new_era" value="{{ new_era if new_era is not none else '' }}" />
  </div>
  <div>
    <label for="ybm">Year Bearer Month</label>
    <input type="number" id="ybm" name="ybm" min="0" max="18" value="{{ ybm if ybm is not none else '' }}" />
  </div>
  <div>
    <label for="ybd">Year Bearer Day</label>
    <input type="number" id="ybd" name="ybd" min="0" max="19" value="{{ ybd if ybd is not none else '' }}" />
  </div>
  <div class="actions">
    <button type="submit">Convert</button>
    {% if comp %}<button class="download" type="button" onclick="downloadJSON()">Download JSON</button>{% endif %}
  </div>
</form>
{% if error %}<div class="error">Error: {{ error }}</div>{% endif %}
{% if comp %}
<section>
  <h2>Results</h2>
  <div class="grid">
    <div class="card"><h3>Tzolkin</h3><div class="value">{{ comp.tzolkin_value }} {{ comp.tzolkin_name }}</div></div>
    <div class="card"><h3>Haab</h3><div class="value">{{ comp.haab_day }} {{ comp.haab_month_name }}</div></div>
    <div class="card"><h3>Long Count</h3><div class="value">{{ comp.long_count }}</div></div>
    <div class="card"><h3>Year Bearer</h3><div class="value">0x{{ '%04X' % comp.year_bearer_packed }}</div></div>
    <div class="card"><h3>819 Cycle</h3><div class="value">Station {{ comp.cycle819_station }} / {{ comp.cycle819_value }}</div></div>
    <div class="card"><h3>Dir Color</h3><div class="value">{{ comp.dir_color_str }}</div></div>
    <div class="card"><h3>Mercury</h3><div class="value">{{ '%.2f' % comp.mercury_synodic }} ({{ comp.mercury_index }})</div></div>
    <div class="card"><h3>Venus</h3><div class="value">{{ '%.2f' % comp.venus_synodic }} ({{ comp.venus_index }})</div></div>
    <div class="card"><h3>Maya Moon</h3><div class="value">{{ '%.2f' % comp.maya_moon_age }}</div></div>
    <div class="card"><h3>Abn Dist</h3><div class="value">{{ '%.2f' % comp.abnormal_distance }}</div></div>
    <div class="card"><h3>Eclipse?</h3><div class="value">{{ 'Yes' if comp.eclipse_possible else 'No' }}</div></div>
    <div class="card"><h3>Star Zodiac</h3><div class="value">{{ comp.star_zodiac_deg }}° {{ comp.star_zodiac_name }}</div></div>
    <div class="card"><h3>Earth Zodiac</h3><div class="value">{{ comp.earth_zodiac_deg }}° {{ comp.earth_zodiac_name }}</div></div>
  </div>
  <h3>Raw JSON</h3>
  <pre id="rawjson">{{ comp | tojson(indent=2) }}</pre>
</section>
{% endif %}
<footer>Generated by Pohualli Python port.</footer>
</body>
</html>
